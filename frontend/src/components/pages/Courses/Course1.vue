<!-- <template>
  <div>
    <h1>待....c1</h1>
  </div>
</template>

<script setup>
</script>

<style scoped>
</style> -->


<template>
  <div class="container">
    <h1>使用單字卡學習後進行測驗!</h1>
    <div class="tabs">
      <button @click="showSection('flashcard')" :class="{ active: currentSection === 'flashcard' }">單字卡</button>
      <button @click="showSection('quiz')" :class="{ active: currentSection === 'quiz' }">測驗</button>
    </div>

    <!-- Flashcard Section -->
    <div v-if="currentSection === 'flashcard'" id="flashcard-section">
      <div id="card">
        <p id="chinese" class="big">{{ cards[currentCard].chinese }}</p>
        <p id="hakka" class="roman">{{ cards[currentCard].hakka }}</p>
        <button @click="playAudio(cards[currentCard].audio)" :disabled="!cards[currentCard].audio">🔊 播放客語</button>
      </div>
      <div class="nav">
        <button @click="prevCard">上一張</button>
        <button @click="nextCard">下一張</button>
      </div>
      <p id="progress">第 {{ currentCard + 1 }} / {{ cards.length }} 張</p>
    </div>

    <!-- Quiz Section -->
    <div v-if="currentSection === 'quiz'" id="quiz-section">
      <template v-if="quizIndex < quizOrder.length">
        <p id="quiz-question" class="big">「{{ cards[quizOrder[quizIndex]].chinese }}」的客語是？</p>
        <button @click="playAudio(cards[quizOrder[quizIndex]].audio)" :disabled="!cards[quizOrder[quizIndex]].audio">🔊 播放客語</button>
        <div id="quiz-options">
          <button v-for="option in quizOptions" :key="option" @click="checkQuizAnswer(option, cards[quizOrder[quizIndex]].hakka)" :style="option.style">{{ option.text }}</button>
        </div>
        <button @click="nextQuizQuestion" :disabled="!quizAnswered">下一題</button>
        <p id="quiz-score">目前得分：{{ quizScore }}</p>
      </template>
      <template v-else>
        <p id="quiz-question" class="big">測驗完成！</p>
        <p id="quiz-score">總得分：{{ quizScore }} / {{ cards.length }}</p>
      </template>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue';

const cards = ref([
  { chinese: "你好", hakka: "ngi ho", audio: "/audio/ngi_ho.m4a" },
  { chinese: "謝謝", hakka: "an zii se", audio: "/audio/an_zii_se.m4a" },
  { chinese: "再見", hakka: "zai jien", audio: "/audio/zai_jien.mp3" },
  { chinese: "早安", hakka: "zao an", audio: "/audio/zao_an.mp3" },
  { chinese: "午安", hakka: "ngou an", audio: "/audio/ngou_an.mp3" },
  { chinese: "晚安", hakka: "ban an", audio: "/audio/ban_an.mp3" },
  { chinese: "水", hakka: "chui", audio: "/audio/chui.mp3" },
  { chinese: "火", hakka: "foi", audio: "/audio/foi.mp3" },
  { chinese: "吃", hakka: "sik", audio: "/audio/sik.mp3" },
  { chinese: "喝", hakka: "ham", audio: "/audio/ham.mp3" },
  { chinese: "學習", hakka: "hok sip", audio: "/audio/hok_sip.mp3" },
  { chinese: "請", hakka: "qin", audio: "/audio/qin.mp3" },
  { chinese: "對不起", hakka: "te pu qi", audio: "/audio/te_pu_qi.mp3" },
  { chinese: "是", hakka: "si", audio: "/audio/si.mp3" },
  { chinese: "不是", hakka: "m si", audio: "/audio/m_si.mp3" },
  { chinese: "飯", hakka: "pan", audio: "/audio/pan.mp3" },
  { chinese: "買", hakka: "mai", audio: "/audio/mai.mp3" },
  { chinese: "賣", hakka: "mai vun", audio: "/audio/mai_vun.mp3" },
  { chinese: "貴", hakka: "gui", audio: "/audio/gui.mp3" },
  { chinese: "便宜", hakka: "pien yi", audio: "/audio/pien_yi.mp3" },
  { chinese: "這個", hakka: "li ge", audio: "/audio/li_ge.mp3" },
  { chinese: "那個", hakka: "ga ge", audio: "/audio/ga_ge.mp3" },
  { chinese: "在哪裡", hakka: "di bin du", audio: "/audio/di_bin_du.mp3" },
  { chinese: "多少", hakka: "toi to", audio: "/audio/toi_to.mp3" },
  { chinese: "我", hakka: "ngai", audio: "/audio/ngai.mp3" },
  { chinese: "你", hakka: "ngi", audio: "/audio/ngi.mp3" },
  { chinese: "他", hakka: "hi", audio: "/audio/hi.mp3" },
  { chinese: "我們", hakka: "ngai do", audio: "/audio/ngai_do.mp3" },
  { chinese: "今天", hakka: "gim zhin", audio: "/audio/gim_zhin.mp3" },
  { chinese: "明天", hakka: "me gin", audio: "/audio/me_gin.mp3" },
  { chinese: "好", hakka: "ho", audio: "/audio/ho.mp3" },
  { chinese: "不用客氣", hakka: "m yong hak qi", audio: "/audio/m_yong_hak_qi.mp3" },
  { chinese: "聽不懂", hakka: "ngai m dong", audio: "/audio/ngai_m_dong.mp3" },
  { chinese: "我愛你", hakka: "ngai oi ngi", audio: "/audio/ngai_oi_ngi.mp3" },
  { chinese: "你食飽無？", hakka: "ngi sik pan mo?", audio: "/audio/ngi_sik_pan_mo.mp3" },
  { chinese: "這個多少錢？", hakka: "li ge toi to ngien?", audio: "/audio/li_ge_toi_to_ngien.mp3" },
  { chinese: "請再說一次。", hakka: "qin zoi so it ci.", audio: "/audio/qin_zoi_so_it_ci.mp3" },
  { chinese: "我聽不懂客語。", hakka: "ngai m dong hak ngi.", audio: "/audio/ngai_m_dong_hak_ngi.mp3" },
  { chinese: "謝謝你幫忙！", hakka: "to sia ngi bong mang!", audio: "/audio/to_sia_ngi_bong_mang.mp3" }
]);

const currentCard = ref(parseInt(localStorage.getItem('hakkaCard')) || 0);
const audioPlayer = new Audio();
const currentSection = ref('flashcard');

const quizOrder = ref([]);
const quizIndex = ref(0);
const quizScore = ref(0);
const quizOptions = ref([]);
const quizAnswered = ref(false);

function loadCard() {
  if (currentCard.value < 0) currentCard.value = 0;
  if (currentCard.value >= cards.value.length) currentCard.value = cards.value.length - 1;
  localStorage.setItem('hakkaCard', currentCard.value);
}

function playAudio(audioSrc) {
  if (audioSrc) {
    audioPlayer.src = audioSrc;
    audioPlayer.play();
  }
}

function prevCard() {
  currentCard.value = (currentCard.value - 1 + cards.value.length) % cards.value.length;
  loadCard();
}

function nextCard() {
  currentCard.value = (currentCard.value + 1) % cards.value.length;
  loadCard();
}

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function generateOptions(correctIdx) {
  const options = [{ text: cards.value[correctIdx].hakka, correct: true }];
  const indices = [...Array(cards.value.length).keys()].filter(i => i !== correctIdx);
  shuffle(indices);
  for (let i = 0; i < 3 && i < indices.length; i++) {
    options.push({ text: cards.value[indices[i]].hakka, correct: false });
  }
  return shuffle(options);
}

function startQuiz() {
  quizOrder.value = shuffle([...Array(cards.value.length).keys()]);
  quizIndex.value = 0;
  quizScore.value = 0;
  loadQuizQuestion();
}

function loadQuizQuestion() {
  quizAnswered.value = false;
  if (quizIndex.value < quizOrder.value.length) {
    const correctIdx = quizOrder.value[quizIndex.value];
    quizOptions.value = generateOptions(correctIdx);
  }
}

function checkQuizAnswer(option, correctAnswer) {
  if (quizAnswered.value) return;

  quizAnswered.value = true;
  if (option.text === correctAnswer) {
    quizScore.value++;
    option.style = { backgroundColor: '#9cff9c' };
  } else {
    option.style = { backgroundColor: '#ff9c9c' };
  }
}

function nextQuizQuestion() {
  quizIndex.value++;
  loadQuizQuestion();
}

function showSection(section) {
  currentSection.value = section;
  if (section === 'quiz') {
    startQuiz();
  }
}

onMounted(() => {
  loadCard();
});

</script>

<style scoped>
/* Using the same styles from the original CSS file */
.container {
  max-width: 500px;
  margin: 2em auto;
  padding: 2em;
  background-color: rgba(255, 255, 255, 0.85);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

h1 {
  color: #d6336c;
}

.tabs button {
  margin: 0 0.5em;
  padding: 0.5em 1.2em;
  border: none;
  border-radius: 6px;
  background-color: #e0e0e0;
  cursor: pointer;
  transition: background-color 0.2s;
  font-size: 1rem;
}

.tabs button.active {
  background-color: #d0d0ff;
  font-weight: bold;
}

#card, #quiz-section {
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  padding: 1.5em 1em;
  margin-bottom: 1.5em;
}

.big {
  font-size: 1.6rem;
  margin: 0.3em 0 0.6em 0;
}

.roman {
  font-size: 1.3rem;
  color: #555;
  margin: 0.3em 0 1em 0;
}

button {
  margin: 0.4em;
  padding: 0.6em 1.2em;
  border: none;
  border-radius: 6px;
  background-color: #e0e0e0;
  cursor: pointer;
  transition: background-color 0.2s;
  font-size: 1rem;
}

button:hover:not(:disabled) {
  background-color: #d0d0ff;
}

button:disabled {
  background-color: #cccccc;
  cursor: not-allowed;
}

.nav {
  margin-top: 1em;
}

#quiz-options button {
  display: block;
  width: 70%;
  max-width: 320px;
  margin: 0.4em auto;
}
</style>
